pipeline { 
    agent any
    stages {
        stage('Clone Git') {
            steps {
                echo "hello"
            }
        }
        stage('Build Code') {
            steps {
                sh "chmod u+x cal.py"
                sh "./cal.py sqrt 25"
            }
        }
     stage('Test Code') {
            steps {
                sh "chmod u+x test.py"
                sh "./test.py"
            }
        }
     stage('Build Docker'){
             steps{
               script{
              docker.build('calculator','.')
             } 
        }
      
      }
     stage('Docker push'){
            steps{
              script{
                  docker.withRegistry('','DockerHubCred'){
                  sh 'docker tag calculator sambit417/calculator'
                  sh 'docker push sambit417/calculator'
                  }
               }
            }
         }
     stage('Run ansible Playbook'){
            steps{
               script{
                     ansiblePlaybook{
                             playbook: 'deploy.yml',
                             inventory: 'inventory'
                       }
                 }
             }
         }
    }
 
}
